<html>
<head>
<title>TypeScript console</title>
<link rel=stylesheet href="../CodeMirror/lib/codemirror.css"></link>
<link rel=stylesheet href="../CodeMirror/addon/hint/show-hint.css"></link>

<script src="../CodeMirror/lib/codemirror.js"></script>
<script src="../CodeMirror/addon/hint/show-hint.js"></script>
<script src="../CodeMirror/addon/edit/closebrackets.js"></script>
<script src="../CodeMirror/addon/edit/matchbrackets.js"></script>
<script src="../CodeMirror/addon/search/search.js"></script>
<script src="../CodeMirror/addon/search/searchcursor.js"></script>
<script src="../CodeMirror/addon/search/match-highlighter.js"></script>
<script src="../CodeMirror/addon/selection/active-line.js"></script>
<script src="../CodeMirror/addon/selection/mark-selection.js"></script>
<script src="../CodeMirror/mode/javascript/javascript.js"></script>

<style>
.CodeMirror {
	height: auto;
	font-family: auto;
}

.cm-s-default .cm-keyword {
	color: cornflowerblue;
	font-weight: bold;
}

.cm-variable-3 {
	font-weight: bold;
}
</style>
<script src="../typescript/bin/typescriptServices.js"></script>

<script>

var SplitController = (function() {
	function SplitController(_host, _global) {
		if (typeof _global === 'undefined')
			_global = window;
		
		if (typeof _host === 'undefined')
			_host = _global.document.body;

		this._host = _host;
		this._global = _global;

		this._splitterPosition = 0.3;

		this.left = _global.document.createElement('div');
		this.right = _global.document.createElement('div');
		this._outerSplitter = _global.document.createElement('div');
		this._innerSplitter = _global.document.createElement('div');
		this._splitterHandle = _global.document.createElement('div');

		this._applyLeftStyle(this.left.style);
		this._applyRightStyle(this.right.style);
		this._applyOuterSplitterStyle(this._outerSplitter.style);
		this._applyInnerSplitterStyle(this._innerSplitter.style);
		this._applySplitterHandleStyle(this._splitterHandle.style);

		this._innerSplitter.appendChild(this._splitterHandle);
		this._outerSplitter.appendChild(this._innerSplitter);

		this._host.appendChild(this.left);
		this._host.appendChild(this.right);
		this._host.appendChild(this._outerSplitter);

		this._isMouseDown = false;
		this._lastMouseX = -1;
		var _this = this;
		this._outerSplitter.onmousedown = function(e) { _this._mouseDown(e || _global.event); };

		this._mouseMoveClosure = function(e) { _this._mouseMove(e || _global.event); };

		this._outerSplitter.onmouseup = function(e) { _this._mouseUp(e || _global.event); };
	}

	SplitController.prototype.getSplitterPosition = function() {
		return this._splitterPosition;
	}

	SplitController.prototype.setSplitterPosition = function(value) {
		this._splitterPosition = Number(value);
		this.left.style.width = (this._splitterPosition * 100) + '%';
		this.right.style.width = ((1-this._splitterPosition) * 100) + '%';
		this._outerSplitter.style.left = (this._splitterPosition * 100) + '%';
	}

	SplitController.prototype._applyLeftStyle = function(s) {
		s.position = 'absolute';
		s.left = s.top = s.bottom = '0px';
		s.width = '30%';
	}

	SplitController.prototype._applyRightStyle = function(s) {
		s.position = 'absolute';
		s.right = s.top = s.bottom = '0px';
		s.width = '70%';

		s.background = 'white';
	}

	SplitController.prototype._applyOuterSplitterStyle = function(s) {
		s.position = 'absolute';
		s.top = s.bottom = '0px';
		s.left = '30%';
		s.width = '0px';
		s.zIndex = '20000';
	}

	SplitController.prototype._applyInnerSplitterStyle = function(s) {
		s.position = 'absolute';
		s.top = s.bottom = '0px';
		s.left = '-5px';
		s.width = '10px';
		s.cursor = 'e-resize';

		s.background = 'transparent';
	}

	SplitController.prototype._applyHighlightedSplitterStyle = function(s) {
		s.background = 'rgba(0,0,0,0.1)';
	}

	SplitController.prototype._applySplitterHandleStyle = function(s) {
		s.position = 'absolute';
		s.left = s.right = '4.5px';
		s.top = s.bottom = '0px';

		s.background = 'silver';
	}
	
	SplitController.prototype._mouseDown = function(e) {
		this._isMouseDown = true;
		this._lastMouseX = e.x;
		e.cancelBubble = true;
		this._applyHighlightedSplitterStyle(this._innerSplitter.style);

		if (this._global.addEventListener)
			this._global.addEventListener('mousemove', this._mouseMoveClosure, false);
		else if (this._global.attachEvent)
			this._global.attachEvent('onmousemove', this._mouseMoveClosure);

		console.log('mousedown ', e);

		return false;
	}

	SplitController.prototype._mouseMove = function(e) {
		if (!this._isMouseDown)
			return;
		e.cancelBubble = true;
		
		var hostWidth = this._host['offsetWidth'] || this._host['pixelWidth'] || this._host['scrollWidth'] || this._host['offsetWidth'];

		var newSplitterPosition = e.x / hostWidth;

		console.log('mousemove ', e);

		this.setSplitterPosition(newSplitterPosition);
		return false;
	}

	SplitController.prototype._mouseUp = function(e) {
		this._isMouseDown = false;
		e.cancelBubble = true;
		this._applyInnerSplitterStyle(this._innerSplitter.style);

		if (this._global.removeEventListener)
			this._global.removeEventListener('mousemove', this._mouseMoveClosure, false);
		else if (this._global.detachEvent)
			this._global.detachEvent('onmousemove', this._mouseMoveClosure);
		
		console.log('mouseUp ', e);

		return false;
	}

	return SplitController;
})();

var VirtualFileChange = (function() {
	function VirtualFileChange(lineNumber, lineOffset, oldLength, newText) {
		this.lineNumber = lineNumber;
		this.lineOffset = lineOffset;
		this.oldLength = oldLength;
		this.newText = newText;
	}

	VirtualFileChange.prototype.toString = function() {
		return '[' + this.lineNumber + '] @' + this.lineOffset + ':' + this.oldLength + '="' + this.newText + '"';
	};

	return VirtualFileChange;
})();

var VirtualFileLine = (function() {
	function VirtualFileLine(originalText) {
		this.originalText = this.currentText = originalText;
		this.lineEnding = '\n';
	}

	VirtualFileLine.prototype.applyChange = function(lineOffset, oldLength, newText) {
		this.currentText =
			this.currentText.substring(0, lineOffset) +
			newText +
			this.currentText.substring(lineOffset + oldLength);
	}

	return VirtualFileLine;
})();

var VirtualFile = (function() {
	function VirtualFile() {
		this.lines = [];
		this.changes = [];
	}

	VirtualFile.prototype.applyChange = function(lineNumber, lineOffset, oldLength, newText) {
		var change;
		if (lineNumber instanceof VirtualFileChange) {
			change = lineNumber;
		}
		else {
			change = new VirtualFileChange(lineNumber, lineOffset, oldLength, newText);
		}

		var line = this.lines[change.lineNumber];
		if (!line)
			line = new VirtualFileLine(newText);
		else
			line.applyChange(change.lineOffset, change.oldLength, change.newText);

		this.changes.push(change);
	}

	return VirtualFile;
})();

var VirtualFileSystem = (function() {
	function VirtualFileSystem() {
	}

	return VirtualFileSystem;
})();

</script>

<script>
function init() {
	var scontroller = new SplitController();
	scontroller.setSplitterPosition(0.15);

	var editor = CodeMirror(scontroller.right, {
		mode:  "text/typescript",
    	matchBrackets: true,
    	autoCloseBrackets: true,
    	lineNumbers: true,
    	extraKeys: { 'Ctrl-Space' : 'autocomplete' }
	});

	editor.on('change', function(editor, change) {
    	console.log('change',editor,change);
    });


}

window.onload = init;

</script>
</head>
<body>
</body>
</html>